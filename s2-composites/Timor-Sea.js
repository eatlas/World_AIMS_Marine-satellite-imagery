// Copyright 2021 Eric Lawrey - Australian Institute of Marine Science
//
// MIT License https://mit-license.org/
// This script is written to run on the Google Earth Engine 
var utils = require('users/ericlawrey/CS_AIMS_Sentinel2-marine_V1:utils.js');

// These are the options for the primary reference imagery.
// The primary reference imagery should correspond to a composite
// made from the best set of images available, with the goal being
// to get the cleanest image.

var REF1_OPTIONS = {
  //colourGrades: ['TrueColour','DeepFalse','ReefTop','Shallow','Slope'],
  //exportScale: [10, 10, 10, 10, 30],

  colourGrades: ['Shallow'],
  exportScale: [10],
  //colourGrades: ['DeepFalse'],//,'SlopeNew'],
  exportBasename: 'CS_AIMS_Sentinel2-marine_V1_R1',
  exportFolder: 'EarthEngine/CS_AIMS_Sentinel2-marine_V1/Global',
  applySunglintCorrection: true,
  applyBrightnessAdjustment: true
};

// These options correspond to the secondary reference imagery.
// This will be made from the next best set of images. The goal
// is to provide a second set of imagery to determine if spots
// in the imagery are artefacts (from clouds) or real features.
var REF2_OPTIONS = {
  colourGrades: ['DeepFalse','Slope'],
    exportScale: [10, 30],
  exportBasename: 'CS_AIMS_Sentinel2-marine_V1_R2',
  exportFolder: 'EarthEngine/CS_AIMS_Sentinel2-marine_V1/Global',
  applySunglintCorrection: true,
  applyBrightnessAdjustment: true
};

// ===============================================================
//
//                    Timor Sea
//
// ===============================================================
// North West Shelf, Australia. Baracouta East Shoal
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 40 of 76 Images

utils.s2_composite_display_and_export(
  [
  // Excellent - no clouds
  // The following are ratings of the visibility of two shoals at the maximum depth of visibility
  // Each image was rated out of 5, where 0 indicates that the shoal is not visible.
  // Images where the visibility was rated 0 were excluded from the reference 1 image
  // Shoal 1 - Just east of Baracouta East (bottom left of tile)
  // Shoal 2 - North West of tile
                                                            // Shoal 1, Shoal 2
    "COPERNICUS/S2/20160824T015622_20160824T065137_T51LXG", // 1, 1
    "COPERNICUS/S2/20170819T015701_20170819T020019_T51LXG", // 1, 1.5
    "COPERNICUS/S2/20170903T015649_20170903T020007_T51LXG", // 2, 0.5
    "COPERNICUS/S2/20180610T015619_20180610T015817_T51LXG", // 0.5, 0.5
    "COPERNICUS/S2/20180725T015621_20180725T015621_T51LXG", // 1, 0.5 
    "COPERNICUS/S2/20190426T015629_20190426T015717_T51LXG", // 1, 1
    "COPERNICUS/S2/20190824T015029_20190824T015926_T51LXG"  // 0.5, 1.5
  ],
  false, false, REF1_OPTIONS);

// Excellent - no clouds, but lower water clarity
utils.s2_composite_display_and_export(
  [
    "COPERNICUS/S2/20190506T015629_20190506T015719_T51LXG", // 0.5, 0.5 // some clouds
    "COPERNICUS/S2/20170511T015701_20170511T015839_T51LXG", // 0, 1
    "COPERNICUS/S2/20180511T015619_20180511T015619_T51LXG", // 0, 0
    "COPERNICUS/S2/20190705T015629_20190705T015719_T51LXG", // 0, 0
    "COPERNICUS/S2/20190804T015629_20190804T015718_T51LXG", // 0, 0
    "COPERNICUS/S2/20190829T015021_20190829T015658_T51LXG", // 0, 1
    "COPERNICUS/S2/20181013T015621_20181013T015617_T51LXG",	// 0.5, 1
    "COPERNICUS/S2/20190625T015629_20190625T015719_T51LXG",	// 0, 0.5
    "COPERNICUS/S2/20190809T015631_20190809T015625_T51LXG"	// 0, 0.5	// low waves
  ],
  false, false, REF2_OPTIONS);
  
// tileID = '51LXF';   // North West Shelf, Australia. Vulcan, Goeree Shoals
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 49 of 98 images

utils.s2_composite_display_and_export(
  [
    // Excellent - no clouds
    "COPERNICUS/S2/20160824T015622_20160824T015622_T51LXF",
    "COPERNICUS/S2/20160913T015622_20160913T015617_T51LXF",
    "COPERNICUS/S2/20170730T015701_20170730T015834_T51LXF",
    "COPERNICUS/S2/20170903T015649_20170903T020007_T51LXF", // Some turbulence
    "COPERNICUS/S2/20180725T015621_20180725T015621_T51LXF",
    "COPERNICUS/S2/20180809T015619_20180809T020050_T51LXF",
    "COPERNICUS/S2/20180908T015609_20180908T020045_T51LXF",
    "COPERNICUS/S2/20180918T015609_20180918T020006_T51LXF",
    "COPERNICUS/S2/20181008T015619_20181008T020050_T51LXF"  // 0.5, 1.5
  ],
  false, false, REF1_OPTIONS);

// Excellent - no clouds, but lower water clarity
utils.s2_composite_display_and_export(
  [
    // Excellent - no clouds, lower water clarity
    "COPERNICUS/S2/20160804T015622_20160804T015624_T51LXF",
    "COPERNICUS/S2/20170923T015639_20170923T015924_T51LXF",
    "COPERNICUS/S2/20180625T015621_20180625T015621_T51LXF",
    "COPERNICUS/S2/20180710T015619_20180710T020050_T51LXF",
    "COPERNICUS/S2/20180715T015621_20180715T015622_T51LXF",
    "COPERNICUS/S2/20180720T015619_20180720T015658_T51LXF",
    "COPERNICUS/S2/20180819T015619_20180819T015654_T51LXF",
    "COPERNICUS/S2/20180903T015621_20180903T015618_T51LXF",
    "COPERNICUS/S2/20190416T015629_20190416T015818_T51LXF",
    "COPERNICUS/S2/20190625T015629_20190625T015719_T51LXF",
    "COPERNICUS/S2/20190705T015629_20190705T015719_T51LXF",
    "COPERNICUS/S2/20190804T015629_20190804T015718_T51LXF",
    "COPERNICUS/S2/20190809T015631_20190809T015625_T51LXF",
    "COPERNICUS/S2/20190814T015029_20190814T015840_T51LXF",
    "COPERNICUS/S2/20190824T015029_20190824T015926_T51LXF",
    "COPERNICUS/S2/20190829T015021_20190829T015658_T51LXF"
  ],
  false, false, REF2_OPTIONS);

// North West Shelf, Australia. Ashmore reef
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 50 of 82 images

utils.s2_composite_display_and_export(
  [
    // Excellent
    "COPERNICUS/S2/20170703T020751_20170703T020751_T51LWG",
    "COPERNICUS/S2/20170807T020749_20170807T020833_T51LWG",
    "COPERNICUS/S2/20170827T020749_20170827T020747_T51LWG",
    "COPERNICUS/S2/20180509T020451_20180509T020447_T51LWG",
    "COPERNICUS/S2/20180906T020441_20180906T021028_T51LWG",
    "COPERNICUS/S2/20190708T020459_20190708T020508_T51LWG",
    "COPERNICUS/S2/20190807T020029_20190807T020716_T51LWG",
    "COPERNICUS/S2/20190901T020021_20190901T020607_T51LWG"
  ],
  false, false, REF1_OPTIONS);

// Excellent - no clouds, but lower water clarity
utils.s2_composite_display_and_export(
  [
    // Excellent, but with lower water quality          
    "COPERNICUS/S2/20180703T020449_20180703T020824_T51LWG",
    "COPERNICUS/S2/20180723T020439_20180723T020822_T51LWG",
    "COPERNICUS/S2/20180807T020451_20180807T020445_T51LWG",
    "COPERNICUS/S2/20190524T020451_20190524T020926_T51LWG",
    "COPERNICUS/S2/20190628T020459_20190628T021054_T51LWG",
    "COPERNICUS/S2/20190703T020451_20190703T021036_T51LWG",
    // Good                                             
    "COPERNICUS/S2/20180419T020451_20180419T021043_T51LWG",
    "COPERNICUS/S2/20180524T020439_20180524T020757_T51LWG",
    "COPERNICUS/S2/20180603T020439_20180603T021010_T51LWG",
    "COPERNICUS/S2/20180613T020449_20180613T020758_T51LWG",
    "COPERNICUS/S2/20180424T020449_20180424T020537_T51LWG",
    "COPERNICUS/S2/20180911T020439_20180911T020950_T51LWG",
    "COPERNICUS/S2/20190713T020451_20190713T021051_T51LWG",
    "COPERNICUS/S2/20190817T020029_20190817T020754_T51LWG",
    "COPERNICUS/S2/20160429T020809_20160429T033343_T51LWG"
  ],
  false, false, REF2_OPTIONS);

  //51LUE Scott Reef, WA, Australia
// 156 images; searched from 1-17 and 94 - 156

utils.s2_composite_display_and_export(
  [
    //Excellent
    "COPERNICUS/S2/20210930T020451_20210930T020449_T51LUE",
    "COPERNICUS/S2/20210925T020449_20210925T021044_T51LUE",
    "COPERNICUS/S2/20210905T020439_20210905T020441_T51LUE",
    "COPERNICUS/S2/20210717T020449_20210717T020454_T51LUE",
    "COPERNICUS/S2/20210707T020449_20210707T020446_T51LUE",
    "COPERNICUS/S2/20210702T020451_20210702T020921_T51LUE",
    "COPERNICUS/S2/20210418T020439_20210418T020447_T51LUE",
    "COPERNICUS/S2/20201114T020451_20201114T021101_T51LUE",
    "COPERNICUS/S2/20201005T020451_20201005T020451_T51LUE",
    "COPERNICUS/S2/20200930T020449_20200930T021031_T51LUE",
    "COPERNICUS/S2/20200910T020449_20200910T020454_T51LUE",
    "COPERNICUS/S2/20200905T020451_20200905T020822_T51LUE"
  ],
  false, false, REF1_OPTIONS);


utils.s2_composite_display_and_export(
  [
    // Excellent
    "COPERNICUS/S2/20200831T020449_20200831T020459_T51LUE",
    "COPERNICUS/S2/20200826T020451_20200826T020450_T51LUE",
    "COPERNICUS/S2/20200821T020449_20200821T020455_T51LUE",
    "COPERNICUS/S2/20200816T020451_20200816T021037_T51LUE",
    "COPERNICUS/S2/20200727T020451_20200727T021037_T51LUE",
    "COPERNICUS/S2/20200617T020451_20200617T021037_T51LUE",
    "COPERNICUS/S2/20200602T020449_20200602T020500_T51LUE",
    "COPERNICUS/S2/20200428T020451_20200428T021033_T51LUE",
    "COPERNICUS/S2/20200324T020449_20200324T021008_T51LUE",
    "COPERNICUS/S2/20200319T020441_20200319T021027_T51LUE"
  ],
  false, false, REF2_OPTIONS);
  
// 51LWH - North West Shelf
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 25 of 55 Images

utils.s2_composite_display_and_export(
  [
    // Excellent
    "COPERNICUS/S2/20170802T020451_20170802T020833_T51LWH",
    "COPERNICUS/S2/20180603T020439_20180603T021010_T51LWH",
    "COPERNICUS/S2/20180723T020439_20180723T020822_T51LWH",

    // Good
    "COPERNICUS/S2/20170713T020451_20170713T020619_T51LWH",
    "COPERNICUS/S2/20170827T020749_20170827T020747_T51LWH",

    // ok
    "COPERNICUS/S2/20180613T020449_20180613T020758_T51LWH"
  ],
  false, false, REF1_OPTIONS);
  
// 51LYH - North West Shelf
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 25 of 49 Images
utils.s2_composite_display_and_export(
  [
    // Excellent
    "COPERNICUS/S2/20180908T015609_20180908T015611_T51LYH",
    "COPERNICUS/S2/20190506T015629_20190506T015719_T51LYH",
    // Good
    "COPERNICUS/S2/20170730T015701_20170730T015834_T51LYH",
    "COPERNICUS/S2/20180610T015619_20180610T015817_T51LYH",
    "COPERNICUS/S2/20190809T015631_20190809T015625_T51LYH"
  ],
  false, false, REF1_OPTIONS);

// 51LXH - North West Shelf
// CLOUDY_PIXEL_PERCENTAGE = 0.1
// 30 of 76 Images
utils.s2_composite_display_and_export(
  [
    // Excellent
    "COPERNICUS/S2/20170827T020749_20170827T020747_T51LXH",
    "COPERNICUS/S2/20180509T020451_20180509T020447_T51LXH",
    "COPERNICUS/S2/20190426T015629_20190426T015717_T51LXH",
    // Good
    "COPERNICUS/S2/20160107T015552_20160107T015552_T51LXH",
    "COPERNICUS/S2/20170713T020451_20170713T020619_T51LXH",
    "COPERNICUS/S2/20180703T020449_20180703T020824_T51LXH"
  ],
  false, false, REF1_OPTIONS);